ch11. AWS에 프로젝트 배포하기
--------------------------------
## 1. 사전 지식 : AWS

### 1) AWS란?
* 다른 PC에서도 이 서비스에 접속할 수 있도록 실제 서버에 스프링 부트 서버를 올려 실행하는
즉. 배포해야함.
* 배포하는 2가지 방법
  * 서버용 PS 구입
  * AWS와 같은 클라우드 컴퓨팅 서비스 이용

### 2) AWS 서비스로 우리의 서비스 배포하기
* AWS 상에서 서버를 구성해야 함(즉, 가상 PS를 마련)
* 그 외 많은 서비스 직접 생성해야 함
  * 우리가 사용할 서비스
    * EC2 : AWS에서 제공하는 원격 서버
      * 오토 스케일일 그룹
      * 타깃 그룹
      * 로드 밸런서
    * RDS : AWS에서 제공하는 원격 데이터베이스 

  * 서버 EC2 :  서버 한 대를 임대하는 서비스
  * 오토 스케일링 그룹 :  사용자의 요청 횟수에 따라 EC2를 늘이거나 줄이는 서비스
  * 로드 밸런서 : 요청을 분산 시킴, 로드 밸런서를 만들 때는 요청을 어디로 분산 시킬지 그룹을 정하는데 이때의 그룹을 target 그룹이라고 함
  * RDS : 데이터 저장소, 즉 DB도 클라우드에 올려야 함. AWS에서 제공하는 여러 DB서비스 중 하나
    * 이러한 서비스를 모두 이해하고 사용하기 어려움, 이를 해결하기 위해 등장한게 일랙스틱 빈스트크라는 서비스
    
### 3) 설정이 간편한 일래스틱 빈스토크
* 앞서 언급한 서비스를 한 번에 설정하는 서비스
* 서버 업로드용 코드만 작성해도 서비스를 쉽게 올릴 수 있고, 그 외의 기능들을 일래스틱 빈스트크  메뉴 안에 직접 구성하거나 설정 파일로 자동 처리할 수 있음.
* 추가 비용x, 
* 사용 과정
  * 애플리케이션 생성 -> 애플리케이션 소스를 번들 형태(ex. Java.war 파일)로 버전을 업로드 -> 일래스틱 빈스트크가 자동으로 환경 실행 & 코드 실행에 필요한 AWS 리소스 생성하고 구성함
  * 환경 실행 후에는 환경을 직접 관리하고 필요한 경우 버전 업데이트, 새로운 앱 버전 배포 가능

---------------------------------------------------------

## 2. AWS 계정 생성하기
* 프리티어 버전으로 생성(1년 무료)

---------------------------------------------------------

## 3. 일래스틱 빈스토크로 서버 구축하기

### (1) 일래스틱 빈스토크로 서비스 생성하기
* 서버 제공 위치 지정
* 빈스토크 서비스 생성
* 애플리케이션 생성
* 프로젝트 생성이 완료되면 [환경]으로 일래스틱 빈스토크 환경 목록에서 방금 생성한 환경의 상태가 OK인지 확인하고 URL 클릭해 해당 URL에 잘 접속되는지 확인

### (2) 일래스틱 빈스토크에 RDS 생성하기
* 빈스토크 환경에서 [구성] 눌러 환경 설정 메뉴에 들어감, DB메뉴에서 DB 설정 추가함
* db생성
* 생성 후 [구성]의 DB에서 정보 확인 가능 (H2에서 RDS로 연결할 떄 사용함)
* 애플리케이션도 생성한 DB 사용하도록 변경
* 이렇게 설정한 환경 속성 값은 애플리케이션 실행 시 스프링 부트의 환경 변수, 즉, properties.yml 파일의 설정값 역할을 함. 
application.yml에서 spring 항목의 datasource 항목들만 지움
###

### (3) 로컬에서 RDS연결하기
* 지금까지 로컬에서 사용하던 H2대신 AWS의 RDS사용
* 콘솔에서 조회 불가하므로 DB 도구 사용해야 함
#### 1단계 : 빈스토크 구성 > DB 영역의 엔드포인트 물러 DB관리 페이지로 이동
#### 2단계 : 로컬 아이피 허용, DB항목의 DB 식별자 있는 링크 눌러 이동라고 , [연결&보안]탭의 보안 그룹에 있는 VPC 보안 그룹 하이퍼링크 클릭
#### 3단계 : 인바운드 규칙 편집, DB 인스턴스의 트래픽 관리할 수 있음
#### 4단계 : 기본값 수정
#### 5단계 : 인텔리제이에소 database navigator 플러그인 설치해 DB연결
#### 6단계 : DB 정보창에 RDS 정보 입력
#### 7단계  DB Browser 메뉴바에서 SQL 콘솔창 열어 테이블 생성 SQL문 작성해 실행
#### 8단계 : build.gradle 파일에 의존성 추가
#### 9단계 : article.js 수정

### (4-1) 배포
#### 1단계 : 인텔리제이 > gradle 탭 누르고 빌드 진행
#### 2단계 : build > libs 에 빌드 완성 파일 생성됨. 생성된 jar파일 복사해두기
#### 3단계 : 빈스토크 > 생성된 환경의 이름 선택하고 [업로드 및 배포] > [파일 선택] > jar 파일 선택
#### 4단계 : 구성 > 편집 > 하위 포트값과 민감한 정보 추가
#### 5단계 : 업데이트 > 제공하는 URL 접속 /login 붙여 접속 확인, 
* OAuth 로그인 액세스 거부 오류 -> OAuth 서비스에서 승인된 URL에 일래스틱 빈스토크 서버 URL 추가

### (4-2) 글에 글쓴이 추가하기

#### 1단계 : OAuth 서비스에서 승인된 URL에 URI 추가
#### 2단계 : 확인



# 스프링부트 3와 테스트 

## 테스트 코드 개념 익히기

**테스트 코드란?**
- 작성한 코드가 의도대로 잘 동작하고 예상치 못한 문제가 없는지 확인할 목적으로 작성하는 코드
- test 디렉터리에서 작업
- gien-when-then 패턴 : 테스트코드를 세 단계로 구분해 작성하는 방식
    - given : 테스트 실행 준비 단계
    - when : 테스트 진행 단계
    - then : 테스트 결과 검증 단계
---

## 스프링 부트 3와 테스트

**JUnit**
- JUnit : 자바 언어를 위한 단위 테스트 프레임워크
    - 단위 테스트 : 작성한 코드가 의도대로 작동하는지 작은 단위(메서드)로 검증하는 것
- 특징
    - 테스트 방식을 구분할 수 있는 애너테이션 제공
    - @Test 애너테이션으로 메서드를 호출할 때마다 새 인스턴스 생성, 독립 테스트 가능
    - 예상 결과를 검증하는 어설션 메서드 제공
    - 단순한 사용 방법, 적은 테스트 코드 작성 시간
    - 자동 실행, 자체 결과를 확인하고 즉각적인 피드백 제공
<br/>

**JUnit으로 단위 테스트 코드 만들기**
   - `@DisplayName` : 테스트 이름 명시하는 애너테이션
   - `@Test` : @Test 애너테이션을 붙인 메서드는 테스트를 수행하는 메서드
   - `@BeforeAll`
       - 전체 테스트 시작 전, 처음으로 한 번만 실행
       - 데이터베이스 연결, 테스트 환경 초기화할 때 사용
       - 전체 테스트 실행 주기에서 한 번만 호출되어야 하므로 static으로 선언
   - `@BeforeEach`
       - 테스트 케이스 시작하기 전에 매번 실행
       - 테스트 메서드에서 사용하는 객체 초기화, 테스트에 필요한 값 미리 넣을 때 사용
   - `@AfterAll`
       - 전체 테스트 후, 종료하기 전 한 번만 실행
       - 데이터베이스 종료, 자원 해제할 때 사용
       - 전체 테스트 실행 주기에서 한 번만 호출되어야 하므로 static으로 선언
   - `@AfterEach`
       - 각 테스트 케이스 종료하기 전 매번 실행
       - 테스트 메서드에서 특정 데이터 삭제할 때 사용
   - @BeforeAll -> 테스트 케이스 개수만큼 반복[@BeforeEach -> @Test -> @AfterEach] -> @AfterAll
<br/>

**AssertJ로 검증문 가독성 높이기**
    - AssertJ : 검증문의 가독성을 높여주는 라이브러리
   ```java
   // 가독성 좋은 AssertJ 예시
   // a와 b를 더한 값이 sum과 같아야 한다는 의미로 명확하게 읽힘
   // 기댓값과 비교값이 명확히 구분
   assertThat(a+b).isEqualTo(sum);
   ```
---

## 제대로 테스트 코드 작성해보기

**TestControllerTest.java**
  - `@SpringBootTest`
       - 메인 애플리케이션 클래스에 추가하는 애플리케이션인 @SpringBootApplication이 있는 클래스를 찾고 그 클래스에 포함되어 있는 빈을 찾은 다음 테스트용 애플리케이션 컨텍스트 생성
  - `@AutoConfigureMockMvc`
       - MockMvc 생성, 자동으로 구성
       - MockMvc : 컨트롤러를 테스트할 때 사용되는 클래스. 애플리케이션을 서버에 배포하지 않고도 테스트용 MVC 환경을 만들어 요청 및 전송, 응답 기능을 제공하는 유틸리티 클래스
  - `perform()` 메서드 : 요청을 전송.
       - 결과로 ResultActions 객체를 받음
       - ResultActions 객체는 반환값을 검증하고 확인하는 andExpect() 메서드 제공
  - `accept()` 메서드 : 요청을 보낸 때 무슨 타입으로 응답을 받을지 결정
  - `andExpect()` 메서드 : 응답 검증.
       - `isOk()` 메서드를 사용해 응답 코드가 OK(200)인지 확인
       - 객체의 id, name값이 DB에 저장된 값과 같은지 확인
  - `jsonPath(“$[0].${필드명}”)` 메서드 : JSON 응답값의 값을 가져옴
       - 0번째 배열에 들어있는 객체의 id, name값을 가져옴
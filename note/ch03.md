# 스프링 부트 3 구조 이해하기

### 3.1 스프링 부트 3 구조 살펴보기
**3.1.1 카페와 빵집으로 이해하는 계층**
- 카페와 빵집: 협업 관계, 커피를 사면 빵을 할인하는 소통 가능
    - 계층 간(카페와 빵집 간)에 영향을 줄 수는 없음
- 스프링 부트: 
    - 계층 간의 통신
    - 프레젠테이션 <-> 비즈니스 <-> 퍼시스턴스 <-> 데이터베이스
    - 계층: 개념의 영역
    - 컨트롤러, 서비스, 리포지토리: 실제 구현을 위한 영역
- **프레젠테이션 계층** - 컨트롤러
    - HTTP 요청을 받고 이 요청을 비즈니스 계층으로 전송
    - 컨트롤러: 예) TestController 클래스
- **비즈니스 계층** - 서비스
    - 모든 비즈니스 로직을 처리함
    - 비즈니스 로직: 서비스를 만들기 위한 로직, 웹 사이트에서 일어나는 모든 작업
- **퍼시스턴스 계층** - 리포지토리  
    - 모든 데이터베이스 관련 로직을 처리함
    - DAO 객체 사용 가능: 데이터베이스 계층과 상호작용하기 위한 객체

**3.1.2 스프링 부트 프로젝트 디렉터리 구성하며 살펴보기**
- main: 실제 코드를 작성하는 공간
- test: 테스트할 목적의 코드나 리소스 파일
- buld.gradle: 빌드를 설정하는 파일, 의존성이나 플로그인 설정
- settings.gradle: 빌드할 프로젝트의 정보 설정하는 파일

### 3.2 스프링 부트 3 프로젝트 발전시키기
**3.2.1 build.gradle에 의존성 추가하기**
- 추가한 의존성 
    - 스프링 데이터 JPA
    - 인메모리 데이터베이스 H2: 로컬 환경과 테스트 환경에서 사용
    - 롬복: 반복 메서드 작성 작업을 줄여줌

**3.2.2 프레젠테이션, 서비스, 퍼시스턴스 계층 만들기**
- 프레젠테이션 계층:
    - TestController.java: 컨트롤러 코드 작성
- 비즈니스 계층:
    - TestService.java: MemberRepository라는 빈 주입, findAll() 메서드 호출
- 퍼시스턴트 계층: 
    - Member.java: member라는 이름의 테이블에 접근하는 데 사용할 객체 생성
    - MemberRepository.java(인터페이스): Member 클래스에 member 테이블 매핑 

**3.2.4 작동 확인하기**
- SQL 파일 생성:
    - data.sql: 더미 데이터 INSERT할 SQL 파일
- 작동 확인하기 
    - application.yml: 전송 쿼리 확인, 테이블을 생성한 후 data.sql 실행
- 실행 -> 테이블이 만들어진 것 확인
  ![image](https://github.com/gkdudans/efub4-springboot3-developer-study/assets/124586544/56a0b03a-1422-46d9-9607-39bc9b339926)
- 포스트맨 HTTP 요청 결과
  ![image](https://github.com/gkdudans/efub4-springboot3-developer-study/assets/124586544/a0449ca1-d38b-47f2-8156-fa4530cb6db0)

    
### 3.3 스프링 부트 요청-응답 과정 한 방에 이해하기
1. 포스트맨에서 톰캣에 /test GET 요청 -> 스프링 부트 내로 이동
2. 디스패처 서블릿: URL 분석 -> 처리 가능한 컨트롤러를 찾음
    - TestConroller: /test에 대한 GET 요청을 처리할 수 있는 getAllMembers() 가지고 있음
    - TestController에 /test GET 요청 전달됨 
3. 메서드와 요청 매치 -> 비지니스, 퍼시스턴스 계층을 통하면서 필요한 데이터를 가져옴
4. 뷰 리졸버: 템플릿 엔진을 사용해 HTML 문서를 만들거나 JSON, XML 등의 데이터 생성
5. memers를 return -> 결과를 포스트맨에서 볼 수 있음 

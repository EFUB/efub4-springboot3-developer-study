ch12. CI/CD 도입하기
--------------------------------
## 1. 사전 지식 : CI/CD

### 1) CI/CD란?
* 빌드부터 배포까지의 과정을 자동화하는 것
* **지속적 통합, CI**
  * Continuous Integration : 빌드와 테스트를 자동화하는 과정
  * 변경 사항을 자동으로 테스트해 애플리케이션의 문제가 없다는 것을 보장
  * 코드를 정기적으로 빌드하고, 테스트하므로 여러명이 동시에 작업시 충돌 방지하고 모니터링 가능
  * 코드 변경사항이 코드 저장소에 업로드되면 CI를 시작하고 도중 문제가 생기면 실패하므로 코드의 오류 쉽게 파악 가능
* **지속적 제공과 지속적 배포, CD**
  * CI 작업 이후 서버 배포 작업을 자동화하는 작업
  * Continuous Delivery : 지속적 제공
    * 깃허브와 같은 코드 저장소에 자동으로 업로드하는 과정
  * Continuous Deployment : 지속적 배포
    * 지속적 제공을 통해 성공적으로 병합한 코드 내역을 AWS와 같은 AWS와 같은 배포 환경으로 보내는 것을 의미 = "릴리스"

### 2) 깃과 깃허브
* 병렬 개발을 가능하게 하는 코드 저장 관리 서비스

---------------------------------------------------------

## 2. 깃허브 액션 사용하기
* **github actions** : 깃허브에서 제공하는 서비스 
  * 리포지토리, 즉 코드 원격 저장소에 특정 이벤트가 발생하면 특정작업을 하거나, 주기적으로 특정 작업을 반복할 수 있게 함

### 1) 깃허브 리포지토리 생성하고 코드 푸시하기
* git 설치 & github와 연동
1. github에서 레포지토리 생성
2. SSH 접근 주소 복사
3. 인텔리제이 터미널 창열고 git init 명령어 입력
     * git init : 특정 폴더를 깃 저장소로 만들 때 사용 (.git 폴더 생성됨 - 코드 버전 관리 정보 저장)
4. github의 리포지토리 - git 저장소 연결
     * remote 명령어
       * git remote add origin git@github.com:${사용자계정명}/springboot-developer.git
       * : origin 이라는 단축 이름에 git@github.com:${사용자계정명}/springboot-developer.git 이라는 리포지토리 추가함
5. 푸시 (add, commit)
     * add : 스테이지에 올리는
     * commit : 로컬저장소롤 올리는
6. 브랜치명을 main으로 바꾼후 원격 저장소에 저장하기 위해 push
     * git branch -M main
     * git push origin main
7. github에서 확인

### 2) 깃허브 액션 스크립트 작성하기, CI
1. 프로젝트 최상단에 .github 디렉터리 생성
   * .github > workflows > ci.yml 생성하고 스크립트 작성
     1. 워크플로우 이름 지정
     2. 워크플로우가 시작될 조건 지정 : main 브랜치로 푸시가 진행될 떄마다 시작
     3. 실행환경 지정 : (리눅스나 윈도우같은)
     4. 실행 스텝 지정 : 별도의 작엄(uses) 또는 명령어(run)으로 구성
        * uses : 지정한 리포지토리를 확인하고 코드에 대한 작업을 실행할 수 있음
        * name : 스텝 이름 지정
        * run : 실행할 명령어 입력
2. 추가된 파일을 원격 저장소에 올리기 위해 커밋, 푸시를 진행하고 
   깃허브 리포지토리의 action 메뉴에 들어가 CI가 실행되는 것을 확인

### 3) 깃허브 액션 스크립트 작성하기, CD
1. 빌드시 생성되는 두개의 jar파일 중 일반 jar파일만 생성되도록 설정
   * plain jar 파일 : plain archive : 애플리케이션 실행에 필요한 의존성을 포함X, 소스 코드의 클래스 파일과 리소스 파일만 포함
   * 이 플레인 아카이브만으로는 서비스를 실행할 수 없으므로 빌드 시에 일반 jar 파일만 생성하도록 gradle파일 변경
2. ci.yml -> acicd.yml 으로 변경
    * CI/CD로 이름 변경
    * josStorer/get-currnet-time 플러그인 사용해 현재시간 가져옴
      * 가져온 시간은 배포 버전을 지정할 때 사용됨
    * 환경 변수 설정
    * 빈스토크 배포 진행
3. IAM으로 사용자 추가 
   * IAM : AWS 리소스를 사용하도록 권한 부여하는 서비스
   * IAM > 권한 설정 > 직접 정책 연결 > AdministratorAccess-AWSElasticBeanstalk 선택
     * 이 권한은 빈스코트를 사용하기 위해 필요한 모든 관리 권한을 사용자에게 제공하는 권한 (이것보단 정말 필요한 권한만 선택해 주는 것 권장)
   * github-action 사용자 눌러 액세스 키 만들기 -> **생성된 키 반드시 저장!**
4. 저장한 액세스 키 깃허브 리포지토리에 등록
5. 깃허브에 커밋 푸시 전, 민감한 값 삭제
   * application.yml >  비밀값으로 정의한 client-id, client-secret, jwt 항목 삭제
6. 커밋&푸시 후 확인
--------------------------------------------------------

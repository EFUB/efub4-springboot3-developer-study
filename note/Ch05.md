Ch05. 데이터베이스 조작이 편해지는 ORM
-----------------
### 데이터베이스란?
* 데이터베이스 관리자, DBMS
  * DBMS : 데이터베이스 관리위한 소프트웨어 
  * 관계형 DBMS (=RDBMS)
    * 테이블 형태로 이루어진 데이터 저장소
    * H2(개발 시), MySQL(실제 서비스 올릴 때) 사용할 것
      * H2: 스프링 부트 지원 인메모리 관계형 데이터베이스, 애플리케이션 자체 보관, 개발 시에 테스트 용도로 많이 사용
      * DB 용어 : 테이블, 행(레코드), 열, 기본키, 쿼리(SQL 언어 사용)

### ORM이란?
* 자바의 객체와 DB 연결 프로그래밍 기법
* 즉, 객체와 DB를 연결해 자바 언어로만  DB를 다룰 수 있게 하는 도구

### JPA와 하이버네이트?
* 자바에서는 ORM으로 JPA를 표준으로 사용
* JPA: 자바에서 관계형 DB를 사용하는 방식을 정의한 인터페이스, 추가로 ORM 프레임워크 설치 필요
* 하이버네이트 : JPA 인터페이스 구현체이자 자바용 ORM 프레임워크, 내부적으로 JDBC API 사용
  * 자바 객체를 통해 DB 종류 상관없이 DB를 자유자재롤 사용할 수 있게함
* 엔티티 매니저란?
  * 엔티티 : DB에서 테이블과 매핑되는 객체 (쿼리를 실행하는 객체)
  * 엔티티 매니저 : 엔티티 관리해 DB와 애플리케이션 사이에 객체를 생성, 수정, 삭제 하는 등의 역할을 함
    * 이것을 만드는 곳이 엔티티 매니저 팩토리
    * 스프링 부트 내부에서는 엔티티 매니저 팩토리 하나만 생성해 관리하고 @PersistenceContext 또는 @Autowired 애너테이션 사용해  엔티팉 매니저 사용함
* 영속성 컨택스트란?
  * JPA의 중요한 특징, 엔티티를 관리하는 가상 공간
  * 특징
    * 1차 캐시 
      * 내부에 1차 캐시 가지고 있음
      * 이때 캐시의 키는 엔티티의 @Id 애너테이션이 달린 기본키 역할을 하는 식별자이며 값은 엔티티
      * 엔티티 조회하면 1차 캐시에서 데이터 조회하고 값이 있으면 반환, 없으면 DB에서 조회해 1차 캐시에 저장한 다음 반환
      * 캐시된 데이터 DB 거치지 않고 빠르게 조회 가능
    * 쓰기 지연
      * 트랜잭션을 커밋하기 전까지는 쿼릴를 모았다가 커밋하면 한번에 실행하는 것
    * 변경 감지
      * 트랜젝션을 커밋하면 1차 캐시에 저장되어 있는 엔티티의 값과 현재 엔티티의 값을 비교해서 변경사항 감지해 DB에 자동 반영
    * 지연 로딩
      * 쿼리로 요청한 데이터 바로 로딩하지 않고 필요할 떄 쿼리 날려 조회하는 것
  * 이러한 특징들 모두 DB 접근 최소화해 성능 높일 수 있음
* 엔티티의 4가지 상태
  * 분리 상태 : 영속성 컨택스트가 관리하고 있지 않은 , detach() 메소드 사용
  * 관리 상태 : 영속성 컨택스트가 관리하고 있는, persisst() 메소드 사용
  * 비영속 상태 : 영속성 컨택스트와 전혀 관련 없는, 엔티티 처음 생성 시
  * 삭제된 상태 : remove() 메서드 사용 
  * 이 상태는 특정 메소드를 호출해 변경 가능

### 스프링 데이터와 스프링 데이터 JPA
* 스프링 데이터는 DB 사용 기능을 클래스 레벨에서 추상화함
* 스프링 데이터에서 제공하는 인터페이스 통해 사용가능
  * CRUD 포함 여러 메서드 포함, 알아서 쿼리 만들어 줌, 페이지 처리 기능 등등 장점 가짐
* 스프링 데이터 JPA란
  * 스프링 데이터의 공통적인 기능 + JPA 기술
  * 스프링 데이터 인터페이스 상속 받은 JpaRepository 인터페이스 만들었으며, JPA 더 편리하게 사용하는 메서드 제공함
  * (before) 메서드 호출로 엔티티 상테 바꿈 
  <br> -> (after) 인터페이스 상속받고, 제네릭에는 관리할 <엔티티 이름, 엔팉티 기본키의 타입> 입력하면 기본 CRUD 메서드 사용 가능
  * MemberServic 파일 생성 & 코드 작성 & 메서드 사용 해보기

### 예제 코드 살펴보기
* Member.java
  * @Entity : Member 객체를 JPA가 관리하는 엔티티로 지정 
  * @NoArgsConstructor(access = AccessLevel.PROTECTED) : protested 기본 생성자
  * @Id : id 필드를 기본키로 지정
  * @GeneratedValue(strategy = GenerationType.IDENTITY) : 기본 키를 자동으로 1씩 증가
  * @Column(name = "name", nullable = false) : name이라는 not null 컬럼과 매핑
* MemberRepository.java
    * 리포지토리는 엔티티에 잇는 데이터들을 조회하거나 저장, 변경, 삭제를 할 때 사용하는 인터페이스로,
  <br> 스프링 데이터 JPA에서 제공하는 인터페이스인 JpaRepository 믈래스를 상속 받아 간단하게 구현 가능
# 11장 AWS에 프로젝트 배포하기

## 11.1 사전 지식: AWS

- 11.1.1 AWS란?
    - 배포 : 다른 PC에서도 서비스에 접속하기 위해 실제 서버에 스프링 부트 서버를 올려 실행
    - 배포 방법
        - 서버용 PC 구매 후 배포
        - AWS와 같은 클라우드 컴퓨팅 서비스를 이용하여 배포
            - (+) 기업이 구축한 환경에 서버 환경 마련 가능
            - (-) 서비스 사용을 위한 공부가 필요
    - AWS는 다양한 서비스를 제공
        - 컴퓨팅 서비스, 네트워크 서비스, 데이터베이스 서비스, 스토리지 서비스 등
- 11.1.2 AWS 서비스로 우리의 서비스 배포하기
    - AWS 상에서 서버 구성 필요
    - EC2 : AWS에서 제공하는 원격 서버, 서버 한 대를 임대하는 서비스
        - 오토 스케일링 그룹
            - 유동적으로 EC2를 관리함
            - 사용자 요청 횟수에 따라 EC2를 늘이거나 줄임
        - 타깃 그룹
            - 로드 밸런서가 요청을 어디로 분산시킬지에 대한 그룹
        - 로드 밸런서
            - 요청을 분산시킴
    - RDS : AWS에서 제공하는 원격 데이터베이스
- 11.1.3 설정이 간편한 일래스틱 빈스토크
    - 앞서 언급한 서비스를 한 번에 설정하는 서비스
    - 서버 업로드용 코드만 작성해도 서버를 쉽게 올릴 수 있음
    - 그 외 기능인 로드 밸런싱, 오토 스케일링, 모니터링, 배포 등을 일래스틱 빈스토크 메뉴 안에 직접 구성하거나 설정 파일로 자동 처리 가능
    - 사용 과정
        - 어플리케이션 생성
        - 버전 업로드
        - 환경 생성
        - 환경 관리
        - 버전 업데이트 혹은 새로운 앱 버전 배포

## 11.2 AWS 계정 생성하기

- AWS는 계정 생성 후 1년 동안 프리티어 자격을 부여함
- 이미 계정 생성 완료

## 11.3 일래스틱 빈스토크로 서버 구축하기

- 11.3.1 일래스틱 빈스토크 서비스 생성하기
    - 앞으로 만들 서버의 제공 위치 지정 → 살고 있는 위치에서 가까울수록 응답 속도 빠름
    - 검색 창에서 Elastic Beanstalk 검색 → create application 버튼 누르기
    - 애플리케이션 이름 입력, 플랫폼으로 Java Corretto 17 선택
    - 프로젝트 생성 완료 후 [환경]을 눌러 일래스틱 빈스토크 환경 목록 확인 → OK로 보이는지 확인, URL 접속해보기
- 11.3.2 일래스틱 빈스토크에서 RDS 생성하기
    - 일래스틱 빈스토크 환경에서 [구성] 눌러 환경 설정 메뉴에 들어감
    - 데이터베이스 메뉴에서 [편집]을 눌러 데이터베이스 설정 추가
    - 사용할 데이터베이스 엔진 : mysql 선택, 용량 : db.t2.micro
    - 사용자 이름, 암호 작성 → [적용] 버튼
    - [구성] 메뉴에서 데이터베이스 영역 확인
    - AWS 일래스틱 빈스토크 → [구성] 버튼 클릭 → 소프트웨어 [편집] 선택 → 데이터베이스 정보 입력 후 [적용] 버튼 클릭
    - application.yml에서 spring 항목의 datasource 항목 지우기
- 11.3.3 로컬에서 RDS 연결하기
    - 데이터베이스 영역 엔드포인트 클릭 → 데이터베이스 관리 페이지 이동
    - DB 식별자 링크 클릭 → [연결 & 보안] 탭의 보안 그룹에 있는 VPC 보안 그룹 하이퍼링크 클릭
    - 인바운드 규칙 탭 클릭 → [인바운드 규칙 편집] 버튼 클릭
        - 데이터베이스 인스턴스 트래픽 관리
    - 기본값 수정
        - 유형은 [MYSQL/Aurora], 소스는 [내 IP] 선택 → 저장
    - 아이피 주소 확인 방법 : 명령 프롬프트에서 ipconfig 명령어 사용
    - 인텔리제이 [File→Settings…]에서 plugins 옵션 검색
    - database navigator 검색 후 플러그인 설치
    - 데이터베이스 정보 창에 RDS 정보인 Host, Port, User, Password 입력 → [Test Connection] 눌러 연결 잘 되는지 테스트
    - DB Browser 메뉴의 [New SQL Console]을 눌러 SQL문 작성 창 열기 → SQL문 작성 후 실행
    - built.gradle에 의존성 추가
        - implementation ‘mysql:mysql-connector-java’

## 11.4 일래스틱 빈스토크에 우리의 서비스 배포하기

- 11.4.1 애플리케이션 배포하기
    - 인텔리제이 실행 → [Gradle] → [Tasks → build → build] 클릭
    - 빌드 후 [build → libs]에 빌드 완성 파일 생성
        - 생성된 jar 파일 위치 복사해두기
    - 일래스틱 빈스토크에서 생성된 환경 이름 선택 → [업로드 및 배포] → jar 파일 선택
    - [구성] → 소프트웨어 [편집] → 하위 포트 값, 비밀 키, 클라이언트 아이디 등 추가
    - 값 추가 후 [확인] → 환경 업데이트 → 서버의 URL에 접속한 다음 /login 을 붙여 접속 확인
- 11.4.2 OAuth 서비스에 승인된 URL 추가하기
    - 승인된 리디렉션 URI에 일래스틱 빈스토크에서 띄워준 서버 URL 추가
        - /login/oauth2/code/google 붙임